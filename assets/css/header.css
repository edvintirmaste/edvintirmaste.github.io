/* Edvin Portfolio — header.css (v30.0)
   Goal: edge-safe refraction (crisp, straight bar edges) + strong, clean bend inside.
   Wordmark/brand rules preserved.
*/

/* ===== Header bar (baseline) ===== */
header.site-header{
  position:fixed; inset:0 0 auto 0; height:var(--header-h); z-index:20;
  background: linear-gradient(to bottom, rgba(2,2,28,var(--bar-top)), rgba(2,2,28,var(--bar-btm)));
  backdrop-filter: blur(var(--bar-blur)) saturate(var(--bar-sat));
  -webkit-backdrop-filter: blur(var(--bar-blur)) saturate(var(--bar-sat));
  -webkit-mask-image:
    linear-gradient(90deg,
      rgba(0,0,0,1) 0%, rgba(0,0,0,.94) 7%, rgba(0,0,0,1) 13%, rgba(0,0,0,.9) 21%,
      rgba(0,0,0,1) 29%, rgba(0,0,0,.94) 36%, rgba(0,0,0,1) 44%, rgba(0,0,0,.92) 52%,
      rgba(0,0,0,1) 60%, rgba(0,0,0,.94) 69%, rgba(0,0,0,1) 78%, rgba(0,0,0,.92) 86%,
      rgba(0,0,0,1) 100%);
  isolation:isolate;
}

/* ===== Refraction tokens ===== */
:root{
  /* position/scale of sampled copy */
  --fracture-offset-x: 26px;     /* horizontal shift you liked */
  --fracture-offset-y: 16px;
  --fracture-scale: 1.18;        /* extra zoom so offsets never show gaps */

  /* visual strength + blend */
  --fracture-opacity: 0.82;
  --fracture-blend: screen;      /* keeps vibrance; use `normal` for pure displacement */

  /* filter params (read by JS and applied to the SVG filter) */
  --fracture-strength: 24;       /* displacement scale */
  --fracture-frequency: 0.010;   /* turbulence frequency (lower = smoother) */

  /* EDGE SAFETY: inset the filtered layer a few px and softly fade at edges */
  --fracture-edge-pad-x: 10px;   /* horizontal safety */
  --fracture-edge-pad-y: 8px;    /* vertical safety */
}

/* ===== Edge-safe single refraction overlay =====
   - Inset by edge pads (so bar edges stay straight)
   - Fixed background so the sample tracks the viewport scene correctly
   - Zoomed + offset; clean displacement only (no color changes) */
header.site-header::before{
  content:"";
  position:absolute;
  inset: var(--fracture-edge-pad-y) var(--fracture-edge-pad-x);
  pointer-events:none; z-index:0;
  opacity: var(--fracture-opacity);
  will-change: filter;

  background-image: var(--fracture-url, none);
  background-size: cover;               /* keep coverage correct regardless of aspect */
  background-repeat: no-repeat;
  background-attachment: fixed;         /* lock to viewport */
  background-position:
    calc(50% + var(--fracture-offset-x))
    calc(50% + var(--fracture-offset-y));

  /* slight overlay zoom to avoid gaps when offsetting */
  transform: scale(var(--fracture-scale));
  transform-origin: center;

  /* True refraction only */
  filter: url(#et-refract-edgeSafe);
  mix-blend-mode: var(--fracture-blend);

  /* soft inner fade to zero at the very edges so silhouette stays ruler-straight */
  -webkit-mask-image:
    linear-gradient(to bottom,
      transparent 0,
      #000 var(--fracture-edge-pad-y),
      #000 calc(100% - var(--fracture-edge-pad-y)),
      transparent 100%),
    linear-gradient(to right,
      transparent 0,
      #000 var(--fracture-edge-pad-x),
      #000 calc(100% - var(--fracture-edge-pad-x)),
      transparent 100%);
  -webkit-mask-composite: source-in;  /* intersect the two masks (webkit) */
          mask-composite: intersect;  /* intersect (spec) */
}

/* ===== Seam fade below header (baseline) ===== */
header.site-header::after{
  content:"";
  position:absolute; left:0; right:0; top:100%;
  height: calc(var(--fade-depth) + 2px);
  transform: translateY(-2px);
  background: linear-gradient(to bottom, rgba(2,2,28,var(--bar-btm)), rgba(2,2,28,0));
  backdrop-filter: blur(var(--bar-blur)) saturate(var(--bar-sat));
  -webkit-backdrop-filter: blur(var(--bar-blur)) saturate(var(--bar-sat));
  pointer-events:none; z-index:0;
}

/* ===== Nav container (baseline) ===== */
.nav{
  height:var(--header-h);
  display:flex; align-items:center; justify-content:center;
  padding-inline: clamp(16px, 5vw, 64px);
  position:relative; z-index:2;
}

/* ===== Brand / wordmark (baseline — unchanged) ===== */
.brand{
  position:relative;
  width: clamp(var(--brand-min), var(--brand-fluid), var(--brand-max));
  display:flex; align-items:center; justify-content:space-between;
  text-transform:uppercase; white-space:nowrap; user-select:none;
  filter: drop-shadow(0 0 10px rgba(0,0,0,.45));
}
.brand::after{
  content:"";
  position:absolute; left:-14%; right:-14%; top:50%; height:56px;
  transform:translateY(-50%);
  background:
    radial-gradient(60% 140% at 22% 50%, rgba(var(--brand-glow1-rgb), var(--brand-glow-alpha)), rgba(0,0,0,0) 70%),
    radial-gradient(60% 140% at 78% 50%, rgba(var(--brand-glow2-rgb), var(--brand-glow-alpha)), rgba(0,0,0,0) 70%);
  filter: blur(18px); mix-blend-mode: screen; opacity:.95; z-index:-1; pointer-events:none;
}
.brand span{
  position:relative; display:inline-block;
  font-family:"Space Grotesk", Inter, system-ui; font-weight:700; font-size:var(--brand-size); line-height:1;
  text-shadow:0 0 16px rgba(180,205,255,.12);
}
.brand span:not(.space)::after{
  content:""; position:absolute; left:50%; top:50%;
  width:1.05em; height:1.05em; transform:translate(-50%,-50%);
  background: radial-gradient(closest-side, rgba(200,220,255,.06), rgba(0,0,0,0) 70%);
  filter: blur(7px); border-radius:50%; z-index:-1; pointer-events:none;
}
.brand .space{ flex:0 0 var(--word-gap); }
